plugins {
    id 'java'
    id 'eclipse'
	id 'idea'
}

repositories {
    mavenLocal()
}

dependencies {
}

group = 'me.alchemi'
version = '1.0.0'
description = ''
sourceCompatibility = '1.8'

processResources {
	filter  { line -> line.replaceAll('\\$\\{project.version\\}', project.version)}
}

task export {
	dependsOn 'shadowJar'
	finalizedBy 'incrementVersion'

	doLast{
		println 'Exporting to jar file.'
	}
}

task incrementVersion {
	doFirst{
		String minor=version.substring(version.lastIndexOf('.')+1)
		int m=minor.toInteger()+1
		String major=version.substring(0,version.length()-1)
		String s=buildFile.getText().replaceFirst('version = \'' + project.version + '\'','version = \''+major+m+'\'')
		buildFile.setText(s)

		println 'New version ' + major + m
	}
}

eclipse {
	autoBuildTasks jar
}